<!doctype html>
<html lang="en" ng-app="talkfeedApp">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

  <link href='http://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
  <title>Talk Feed</title>
</head>
<body>
  <style type="text/css">
    /* colors: http://www.colourlovers.com/palette/3840327/Shh_its_a_secret */
    [ng\:cloak], [ng-cloak], .ng-cloak {
      display: none !important;
    }

    .intro-section {
      padding: 80px 0;
      background: #008080;

      color: white;
      text-shadow: 0 1px 0 rgba(0,0,0,.1);
      text-align: center;
    }

    .btn-intro {
      border-color: white;
      margin: 15px;
    }

    .btn-intro:hover {
      color: white;
      background: rgba(255, 255, 255, .2);
    }

    .logo {
      font-family: 'Pacifico', cursive;
      font-size: 100px;
      line-height: 200px;
    }

    .about-section {
      padding: 80px 0;

      text-shadow: 0 1px 0 rgba(0,0,0,.1);
      text-align: center;
    }

    .btn {
      background: transparent;
    }

    .panel-primary {
        border-color: #E8A32E;
    }

    .panel-primary>.panel-heading {
        background-image: -webkit-linear-gradient(top,#E8A32E 0,#E8A32E 100%);
        background-image: -o-linear-gradient(top,#E8A32E 0,#E8A32E 100%);
        background-image: -webkit-gradient(linear,left top,left bottom,from(#E8A32E),to(#E8A32E));
        background-image: linear-gradient(to bottom,#E8A32E 0,#E8A32E 100%);
    }

    .panel-primary>.panel-heading {
        color: #fff;
        background-color: #E8A32E;
        border-color: #E8A32E;
    }

    .box {
      padding: 2px;
      border: 1px solid black;
      border-radius: 5px;
    }
  </style>

  <div ng-controller="TalkFeedController">
    <section class="intro-section">
      <div class="container">
          <span class="logo">SpeakerCast</span>
          <p class="lead">When four sessions of General Conference just isn't enough.</p>
          <button scroll-on-click class="btn btn-lg btn-intro">Generate a SpeakerCast</button>
      </div>
    </section>

    <section class="about-section">
      <div class="container">
        <div class="row">
          Create custom podcasts of your favorite conference talks speakers.

          <div class="col-md-4">
            <p class="lead box">The idea behind SpeakerCast is to create a "podcast" from your favorite General Conference speakers. It is neat to listen to every talk by one speaker to get a feel for their reoccurring themes and the way they talk.</p>
          </div>

          <div class="col-md-4">
            <p class="lead box">Something here</p>
          </div>

          <div class="col-md-4">
            <p class="lead box">The idea is to select one or two speakers and create a podcast for them. If you want all of the speakers from General Conference, the Church already provides this (go to <a href="https://www.lds.org/general-conference/sessions">here</a> and click on show feeds).</p>
          </div>
        </div>
      </div>
    </section>

    <section class="row feed">
      <div class="container">
        <div class="col-md-offset-2 col-md-8">
          <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-primary">
              <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                  <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    Current First Presidency and 12 Apostles
                  </a>
                </h4>
              </div>
              <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body ng-cloak">
                  <div class="row">
                    <div class="col-sm-4" ng-repeat="speaker in first_presidency | orderBy:'index'">
                      <input type="checkbox" ng-model="speaker.selected">
                      <span class="selected-{{speaker.selected}}">{{speaker.name}} ({{speaker.talks}})</span>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-4" ng-repeat="speaker in twelve_apostles | orderBy:'index'">
                      <input type="checkbox" ng-model="speaker.selected">
                      <span class="selected-{{speaker.selected}}">{{speaker.name}} ({{speaker.talks}})</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-primary">
              <div class="panel-heading" role="tab" id="headingTwo">
                <h4 class="panel-title">
                  <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    All General Conference Speakers
                  </a>
                </h4>
              </div>
              <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                <div class="panel-body ng-cloak">
                  <div class="row">
                    <label>Search: <input ng-model="searchText"></label>
                  </div>
                  <div class="row">
                    <div class="col-sm-4" ng-repeat="speaker in speakers | filter:searchText">
                      <input type="checkbox" ng-model="speaker.selected">
                      <span class="selected-{{speaker.selected}}">{{speaker.name}} ({{speaker.talks}})</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>

        <div>
          Selected:
          <ul class="ng-cloak">
            <li ng-repeat="selected in selected()">
              {{ selected.name }}
            </li>
          </ul>
        </div>

        <button type="button" class="btn btn-default btn-lg" ng-click="generate()">
          Generate
        </button>

        <div class="alert alert-success alert-dismissible fade in" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
          <p>Here is your feed link:</p>
          <p class="lead">{{ link }}</p>
        </div>
      </div>
    </section>

  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.3/angular.min.js"></script>
  <script type="text/javascript">
    var talkfeedApp = angular.module('talkfeedApp', []);
    var first_presidency_names = ["Thomas S. Monson", "Henry B. Eyring", "Dieter F. Uchtdorf"]
    var twelve_apostles_names = ["Russell M. Nelson", "Dallin H. Oaks", "M. Russell Ballard", "Richard G. Scott", "Robert D. Hales", "Jeffrey R. Holland", "David A. Bednar", "Quentin L. Cook", "D. Todd Christofferson", "Neil L. Andersen"]

    var server_url = "http://127.0.0.1:5000"

    talkfeedApp.controller('TalkFeedController', function($scope, $http) {
        $http.get(server_url + '/speakers').then(function(response) {
          $scope.speakers = response.data;

          $scope.first_presidency = [];
          $scope.twelve_apostles = [];

          angular.forEach($scope.speakers, function(speaker) {
            var first_presidency_index = first_presidency_names.indexOf(speaker.name);
            var twelve_apostles_index = twelve_apostles_names.indexOf(speaker.name);

            if (first_presidency_index >= 0) {
              speaker.index = first_presidency_index;
              $scope.first_presidency.push(speaker);
            }
            else if (twelve_apostles_index>= 0) {
              speaker.index = twelve_apostles_index;
              $scope.twelve_apostles.push(speaker);
            }
          });
        });

        $scope.selected = function() {
          var names = [];
          angular.forEach($scope.speakers, function(speaker) {
            if(speaker.selected) {
              names.push(speaker);
            }
          });
          return names;
        };

        $scope.generate = function() {
          var selected = $scope.selected();

          // TODO: Make sure at least one person is selected

          $http({
            method: 'POST',
            url: server_url + "/generate",
            data: {'speakers': selected}
          }).then(function (response) {
            var id = response.data;

            // console.log(server_url + "/feed/" + id)
            $scope.link = server_url + "/feed/" + id;
          });




          // angular.forEach(selected, function(speaker) {
          //   url += encodeURIComponent(speaker.name + ",");
          // });

          // console.log(url);

          // $http.get('generate').then(function(data) {
          //   console.log("generated...");
          // },
          // function(data) {
          //   console.log('error...');
          // });
        }
      });

    talkfeedApp.directive('scrollOnClick', function() {
      return {
        restrict: 'A',
        link: function(scope, $elm) {
          $elm.on('click', function() {
            $("body").animate({scrollTop: $elm.offset().top + 70}, "slow");
          });
        }
      }
    });
  </script>
</body>
</html>
